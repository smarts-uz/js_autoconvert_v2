function parseURL(n) {
    var t = document.createElement("a");
    return t.href = n, t.hostname
}

function getIframeName() {
    return iFrameName
}

function bindEvent(n, t, i) {
    n.addEventListener ? n.addEventListener(t, i, !1) : n.attachEvent && n.attachEvent("on" + t, i)
}

var initTheme2 = function () {
    $(".js-btn-next").html(theme2Config.buttonsText.next);
    $(".btn-get-started").html(theme2Config.buttonsText.getStarted);
    $(".image-included").addClass("button-list");
    $(".caravan-text").text($(".caravan-text").text().substring(0, $(".caravan-text").text().indexOf(" Motor"))).removeClass("caravan-text");
    $('#step1-start-breadcrumb-form [name="AmountToBorrow"]').attr("type", "number").addClass("loan-amount-display").show();
    $(".js-btn-next, .btn-submit").parents(".col-sm-4").attr("class", "").addClass("col-xs-12");
    typeof theme2Config.customProgressImage != "undefined" && theme2Config.customProgressImage ? $(".progress-step-container .progress-line").append('<div style="background-image:url(' + theme2Config.customProgressImage + ')"><\/div>') : $(".progress-step-container .progress-line").append('<svg xmlns="http://www.w3.org/2000/svg" viewBox = "0 0 58 22.19" > <defs><style>.cls-2{fill:#262626;}<\/style><\/defs> <title>Tweaked_car<\/title> <g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-1" d="M57,22.19V16.53C57,13.46,52.27,11,46.43,11H43.26C40.09,7.65,33.94,1,26.36,1,15.26,1,10,11,6.28,11H4.17A2.16,2.16,0,0,0,2.06,13.2v5.54A1.09,1.09,0,0,0,1,19.85v2.34" /><rect class="cls-1" x="53.83" y="16.3" width="3.17" height="0.02" /><path class="cls-2" d="M58,15.78h0c0-3.51-5.09-6.26-11.57-6.26H43.68C40.32,6.15,34.13,0,26.36,0,19,0,14.11,4,10.56,6.84,8.8,8.27,7.28,9.51,6.28,9.51H4.17a3.11,3.11,0,0,0-3.11,3.11v4.55A2,2,0,0,0,0,19v3.23H2l.06-3.28a1,1,0,0,0,1-1V12.62a1.11,1.11,0,0,1,1.11-1.11H6.28c1.71,0,3.4-1.38,5.54-3.11C15.14,5.7,19.68,2,26.36,2c7,0,12.83,5.85,16,9l.23.23a1,1,0,0,0,.7.29h3.17c4.71,0,8.22,1.57,9.25,3.27H53.83a1,1,0,0,0-1,1,1,1,0,0,0,1,1H56v5.39h2v-6.4h0Z" /><\/g><\/g><\/svg >');
    $('.terms-conditions input[type="checkbox"]').each(function () {
        $(this).addClass("check-box-input").after('<span class="input-check-box"><\/span>')
    })
}, makeStyleSheet = function (n) {
    $("head").find("link#css").length > 0 ? $.get($("head").find("link#css").attr("href"), function () {
    }).done(function (t) {
        function f(n) {
            return n.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
        }

        function e(n, t, i) {
            return n.replace(new RegExp(f(t), "g"), i)
        }

        var i = t, r, u;
        for (r in n.formColours.root) i = e(i, "var(--" + r + ")", n.formColours.root[r]);
        u = document.createElement("style");
        u.appendChild(document.createTextNode(i));
        document.head.appendChild(u);
        $("body").css("opacity", 1)
    }).fail(function () {
        $("body").css("opacity", 1)
    }) : $("style").length > 0 ? $("style").each(function () {
        function r(n) {
            return n.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
        }

        function u(n, t, i) {
            return n.replace(new RegExp(r(t), "g"), i)
        }

        var t = $(this).text();
        for (var i in n.formColours.root) t = u(t, "var(--" + i + ")", n.formColours.root[i]);
        $(this).text(t);
        $("body").css("opacity", 1)
    }) : $.get($("head").find("link[href*='applicationFormGlobal']").attr("href"), function () {
    }).done(function (t) {
        function f(n) {
            return n.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")
        }

        function e(n, t, i) {
            return n.replace(new RegExp(f(t), "g"), i)
        }

        var i = t, r, u;
        for (r in n.formColours.root) i = e(i, "var(--" + r + ")", n.formColours.root[r]);
        u = document.createElement("style");
        u.appendChild(document.createTextNode(i));
        document.head.appendChild(u);
        $("body").css("opacity", 1)
    }).fail(function () {
        $("body").css("opacity", 1)
    });
    setTimeout(function () {
        $("body").css("opacity", 1)
    }, 1200)
}, url, parent_url, sendMessage, ACFormOptionsAvailable;
$(document).ready(function () {
    var t = function () {
        var n = {}, i, t;
        return (typeof termsLink != "undefined" && termsLink.length > 0 && (n["terms and conditions"] = termsLink), typeof privacyLink != "undefined" && privacyLink.length > 0 && (n["privacy policy"] = privacyLink), typeof buisnessTermsLink != "undefined" && buisnessTermsLink.length > 0 && (n["terms of buisness"] = buisnessTermsLink), i = "By submitting your application, you agree to our ", t = 1, $.each(n, function (r, u) {
            var f = t < Object.keys(n).length - 1 ? ", " : t == Object.keys(n).length - 1 ? " and " : ".";
            i += '<a href="' + u + '" target="_blank">' + r + "<\/a>" + f;
            t++
        }), Object.keys(n).length == 0 && typeof parentUrl != "undefined") ? 'By submitting your application, you agree to our <a href="' + window.parentUrl + '/terms-and-conditions" target="_blank">terms and conditions.' : Object.keys(n).length == 0 ? "By submitting your application, you agree to our terms and conditions." : i
    }, n;
    if ($(".aggrement-text").length > 0 && ($(".aggrement-text").html(t()), setTimeout(function () {
        $(".aggrement-text").html(t())
    }, 1500)), typeof formColours != "undefined" && makeStyleSheet(formColours), typeof addressHistoryMonthsValidationLength != "undefined" && $(".js-address-history-required").text((addressHistoryMonthsValidationLength / 12).toFixed(0)), typeof theme2Config != "undefined" && initTheme2(), typeof iDontKnowAmount != "undefined" && typeof iDontKnowAmountText != "undefined") {
        $(".loan-amount-controls-holder").append('<div class="dont-know-amount"><button type="button"><div><\/div><span>' + iDontKnowAmountText + "<\/span><\/button><\/div>");
        n = !1;
        $(document).find(".dont-know-amount button").on("click", function () {
            $(this).toggleClass("active");
            $(this).hasClass("active") ? (n = !0, $(this).attr("data-old-val", $('[name="AmountToBorrow"]').val()), $('[name="AmountToBorrow"]').val(iDontKnowAmount), $(".js-loan-amount-label").val(iDontKnowAmountText).show()) : (n = !1, $('[name="AmountToBorrow"]').val($(this).attr("data-old-val")), $(".js-loan-amount-label").val("£" + $(this).attr("data-old-val")), typeof theme2Config != "undefined" && $(".js-loan-amount-label").hide())
        });
        $('[name="AmountToBorrow"]').on("input change", function () {
            $(this).val() > 0 && (n || ($(".dont-know-amount button").removeClass("active"), typeof theme2Config != "undefined" && $(".js-loan-amount-label").hide()))
        })
    }
    typeof validateEmail != "undefined" && validateEmail == "true" && $(".btn-submit").attr("data-validate-email", "true");
    $(".min-age").text(minApplicationAge)
});
var customAddresses = {
        addressTownToAddressCounty: function () {
            var n = $('input[name="Addresses[0].County"]').val();
            n === "" && ($("input[name$=Location]").val($('input[name="Addresses[0].Town"]').val()), $("input[name$=County]").val($('input[name="Addresses[0].Town"]').val()))
        }, addressToJobAddress: function () {
            var n = $('input[name="Addresses[0].Building"]').val(), t = $('input[name="Addresses[0].BuildingName"]').val(),
                i = $('input[name="Addresses[0].BuildingNumber"]').val(),
                r = $('input[name="Addresses[0].SubBuildingName"]').val(),
                u = $('input[name="Addresses[0].OrganisationName"]').val(),
                f = $('input[name="Addresses[0].Street"]').val(), e = $('input[name="Addresses[0].Town"]').val(),
                o = $('input[name="Addresses[0].County"]').val(), s = $('input[name="Addresses[0].Postcode"]').val(), h;
            $('input[name="Employment[0].Building"]').val(n);
            $('input[name="Employment[0].BuildingName"]').val(t);
            $('input[name="Employment[0].BuildingNumber"]').val(i);
            $('input[name="Employment[0].SubBuildingName"]').val(r);
            $('input[name="Employment[0].OrganisationName"]').val(u);
            $('input[name="Employment[0].Street"]').val(f);
            $('input[name="Employment[0].Town"]').val(e);
            $('input[name="Employment[0].County"]').val(o);
            $('input[name="Employment[0].Postcode"]').val(s);
            h = $('input[name="Employment[1].JobTitle"]').val();
            h != null && ($('input[name="Employment[1].Building"]').val(n), $('input[name="Employment[1].BuildingName"]').val(t), $('input[name="Employment[1].BuildingNumber"]').val(i), $('input[name="Employment[1].SubBuildingName"]').val(r), $('input[name="Employment[1].OrganisationName"]').val(u), $('input[name="Employment[1].Street"]').val(f), $('input[name="Employment[1].Town"]').val(e), $('input[name="Employment[1].County"]').val(o), $('input[name="Employment[1].Postcode"]').val(s))
        }, addressTownToJobTown: function () {
            var n = $('input[name="Addresses[0].Town"]').val(), t;
            $('input[name="Employment[0].Town"]').val(n);
            t = $('input[name="Employment[1].JobTitle"]').val();
            t != null && $('input[name="Employment[1].Town"]').val(n)
        }
    }, acref, lastResponse, $clickedNextButton, creditSearchEnabled = !1, rng = Math.floor(Math.random() * 5),
    scoreContent = function (n) {
        var t;
        switch (n) {
            case null:
                t = "noscore";
                break;
            case 4:
            case"e":
            case"E":
                t = "verypoor";
                break;
            case 3:
            case"d":
            case"D":
                t = "poor";
                break;
            case 2:
            case"c":
            case"C":
                t = "fair";
                break;
            case 1:
            case"b":
            case"B":
                t = "good";
                break;
            case 0:
            case"a":
            case"A":
                t = "excellent"
        }
        $('[data-score-result="' + t + '"]').show();
        $("[data-score-result]").off().on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend", function () {
            $(".continue-after-search").fadeIn(400)
        });
        $(".thank-you-section").addClass("shrink").slideDown("200");
        setTimeout(function () {
            $('[data-score-result="' + t + '"]').addClass("active");
            t !== "noscore" && $(".odometer-wrap").addClass("active " + t)
        }, 200)
    }, showCreditBandingResults = function (n) {
        setTimeout(function () {
            scoreContent(n)
        }, 1e3)
    }, readQueryString = function (n) {
        var r = window.location.href, i, t;
        return (n = n.replace(/[\[\]]/g, "\\$&"), i = new RegExp("[?&]" + n + "(=([^&#]*)|&|#|$)"), t = i.exec(r), !t) ? null : t[2] ? decodeURIComponent(t[2].replace(/\+/g, " ")) : ""
    };
$(document).ready(function () {
    function at(n) {
        var t = document.createElement("a");
        return t.href = n, t.hostname
    }

    function a(t) {
        var i, f;
        console.log("redirect to Lender response", t);
        t.Success === !0 ? (lastResponse = t, window.onbeforeunload = null, sendMessage(JSON.stringify({
            from: getIframeName(),
            acFormCompletionStatus: t
        })), r == "/iframeThankYouInner" ? v() : (t.Acref && window.enableAcRef == !0 && JSON.parse(t.Acref).hasOwnProperty("Reference") && (i = "acref", typeof acRefCustomKey != "undefined" && window.acRefCustomKey.length > 0 && (i = window.acRefCustomKey), acref = JSON.parse(t.Acref).Reference, n += n.indexOf("?") > -1 ? "&" + i + "=" + acref : "?" + i + "=" + acref), typeof passValuesToThankYouPage != "undefined" && passValuesToThankYouPage.length > 0 && (f = function (n) {
            var t = "";
            return $.each(n, function (n, i) {
                var r;
                typeof i == "string" && $("form").find('input[name="' + i + '"]').length > 0 ? (r = $("form").find('input[name="' + i + '"]').val(), t += i + "=" + r + "&") : typeof i == "object" && $("form").find('input[name="' + i[0] + '"]').length > 0 && (r = $("form").find('input[name="' + i[0] + '"]').val(), t += i[1] + "=" + r + "&")
            }), t[t.length - 1] == "&" && (t = t.substring(0, t.length - 1)), t
        }, n += n.indexOf("?") > -1 ? "&" + f(passValuesToThankYouPage) : "?" + f(passValuesToThankYouPage)), top.window.location.href = n)) : u(t)
    }

    function nt(n) {
        console.log("response", n);
        n.Success === !0 ? (lastResponse = n, n.Acref && (acref = JSON.parse(n.Acref).Reference), window.onbeforeunload = null, $(document).find('[name="acref"]').length == 0 && ($("form").prepend('<input type="hidden" readonly name="acref" value="' + JSON.parse(n.Acref).Reference + '">'), $("form").prepend('<input type="hidden" readonly name="partialUpdateAcref" value="true">')), $("form .js-form-area").last().hasClass("area-not-completed") || sendMessage(JSON.stringify({
            from: getIframeName(),
            acFormCompletionStatus: n
        }))) : u(n)
    }

    function vt() {
        window.onbeforeunload = function () {
            return "If you leave or refresh your form progress may be lost."
        }
    }

    function rt() {
        window.onbeforeunload = function () {
        }
    }

    var y, l, g, n, v, ut;
    $("#credit-search-step").length > 0 && (creditSearchEnabled = !creditSearchEnabled);
    var o = new EventPublisher, s = new CustomValidation, i = $("form");
    if (creditSearchEnabled && $("#credit-search-step").prev().find(".js-btn-next").addClass("js-perform-credit-search"), y = function (t) {
        var i = t.parents(".js-form-area");
        isLastItem = i.nextAll(".js-form-area").last().length;
        setTimeout(function () {
            if (isLastItemVisible = $(".js-form-area:visible").nextAll(".js-form-area").last().length, isLastItem == 0 && isLastItem == isLastItemVisible) {
                if (r == "/iframeThankYouInner") v(); else if (r != "/") {
                    if (typeof lastResponse != "undefined" && lastResponse.Acref && window.enableAcRef == !0 && (acref = JSON.parse(lastResponse.Acref).Reference, n += n.indexOf("?") > -1 ? "&acref=" + acref : "?acref=" + acref), typeof passValuesToThankYouPage != "undefined" && passValuesToThankYouPage.length > 0) {
                        var t = function (n) {
                            var t = "";
                            return $.each(n, function (n, i) {
                                var r;
                                typeof i == "string" && $("form").find('input[name="' + i + '"]').length > 0 ? (r = $("form").find('input[name="' + i + '"]').val(), t += i + "=" + r + "&") : typeof i == "object" && $("form").find('input[name="' + i[0] + '"]').length > 0 && (r = $("form").find('input[name="' + i[0] + '"]').val(), t += i[1] + "=" + r + "&")
                            }), t[t.length - 1] == "&" && (t = t.substring(0, t.length - 1)), t
                        };
                        n += n.indexOf("?") > -1 ? "&" + t(passValuesToThankYouPage) : "?" + t(passValuesToThankYouPage)
                    }
                    top.window.location.href = n
                }
                sendMessage(JSON.stringify({from: getIframeName(), acFormCompletionStatus: "acFormCompleted"}))
            }
        }, 75)
    }, typeof progressiveForm != "undefined" && window.progressiveForm) {
        $(".js-form-area").addClass("area-not-completed");
        $(".js-btn-next").on("click", function () {
            $clickedNextButton = $(this);
            $clickedNextButton.hasClass("js-perform-credit-search") && w();
            $(this).parents(".area-not-completed").removeClass("area-not-completed");
            i = $(this).parents("form");
            var n = $(this), t = n.closest(".js-form-area");
            t.hasClass("js-is-valid") && ($(this).hasClass("js-prog-submit") ? typeof jointApp != "undefined" && window.jointApp ? h(i) : ft(i) : $(document).find('[name="partialUpdateAcref"]').length > 0 && $(document).find('[name="partialUpdateAcref"]').val().length > 0 && (typeof jointApp != "undefined" && window.jointApp ? h(i) : p(i, !1)));
            y(n, lastResponse)
        });
        $(".js-submit-form").on("click", function (n) {
            var t, r, u;
            i = $(this).parents("form");
            $(this).parents(".js-form-area").addClass("area-completed");
            t = $(this);
            r = t.closest(".js-form-area");
            n.preventDefault();
            u = $(this).parents(".js-form-area").attr("id");
            o.publishEvent("Breadcrumb-Form", "" + u + "-completed");
            s.formStepsValidation($(this)) && s.formAreaIsValid(r) && (tt(), rt(), o.publishEvent("Breadcrumb-Form", "breadcrumb-form-submitted"), p(i, !0))
        })
    } else $(".js-submit-form").on("click", function (n) {
        var t, r, u;
        i = $(this).parents("form");
        t = $(this);
        r = t.closest(".js-form-area");
        n.preventDefault();
        u = $(this).parents(".js-form-area").attr("id");
        o.publishEvent("Breadcrumb-Form", "" + u + "-completed");
        s.formStepsValidation($(this)) && s.formAreaIsValid(r) && (tt(), rt(), o.publishEvent("Breadcrumb-Form", "breadcrumb-form-submitted"), typeof jointApp != "undefined" && window.jointApp ? h(i) : et(i))
    });
    var f = function (n) {
        var i, f, r, e, u;
        for (typeof forcedData != "undefined" && $.each(forcedData, function (n, t) {
            $(document).find('[name="' + n + '"]').val(t)
        }), $(document).find('input[name="SortCode"]').length > 0 && $(document).find('input[name="SortCode"]').val($(document).find('input[name="SortCode"]').val().replace(/-/g, "").trim()), ot(), i = [], typeof progressiveForm == "undefined" || window.progressiveForm ? ($("input").each(function () {
            $(this).parents(".area-not-completed").length == 0 && (i = i.concat($(this).serializeArray()))
        }), $("select").each(function () {
            $(this).parents(".area-not-completed").length == 0 && (i = i.concat($(this).serializeArray()))
        }), $("textarea").each(function () {
            $(this).parents(".area-not-completed").length == 0 && (i = i.concat($(this).serializeArray()))
        })) : i = n.serializeArray(), f = st(), r = 0; r < f.length; r++) i.push(f[r]);
        for (e = k(), u = 0; u < e.length; u++) i.push(e[u]);
        return t(i, "TermsAndConditions", $("input[name=TermsAndConditions]").val() === "on"), t(i, "AgreeToEmailMarketing", $("input[name=AgreeToEmailMarketing]").is(":checked")), t(i, "AgreeToSmsMarketing", $("input[name=AgreeToSmsMarketing]").is(":checked")), t(i, "AgreeToMarketing", $("input[name=AgreeToMarketing]").is(":checked")), t(i, "CreditSearch", $("input[name=CreditSearch]").is(":checked")), t(i, "SmsConsent", $("input[name=SmsConsent]").is(":checked")), t(i, "CallConsent", $("input[name=CallConsent]").is(":checked")), t(i, "EmailConsent", $("input[name=EmailConsent]").is(":checked")), t(i, "PostConsent", $("input[name=PostConsent]").is(":checked")), t(i, "AffordabilityCheck", $("input[name=AffordabilityCheck]").is(":checked")), t(i, "HasCarInMind", $("input[name=HasCarInMind]").val() === "on"), t(i, "FoundVehicle", $("select[name=FoundVehicle]").val() === "yes"), c(i, "fname", "Forename"), c(i, "lname", "Surname"), c(i, "email", "Email"), $('.js-marketing-opt-in input[type="checkbox"][data-marketing-type="Email"]:checkbox:checked').each(function (n, t) {
            i.push({name: "EmailOptIn[" + n + "]", value: $(t).data("product-name")})
        }), $('.js-marketing-opt-in input[type="checkbox"][data-marketing-type="SMS"]:checkbox:checked').each(function (n, t) {
            i.push({name: "SmsOptIn[" + n + "]", value: $(t).data("product-name")})
        }), i
    }, p = function (n, t) {
        console.log("sendPartialApplication UPDATE");
        var r = f(n), i = [];
        $.each(r, function (n, t) {
            t.value == "" || typeof t.value == "undefined" || i.push(r[n])
        });
        !$("form .js-form-area").last().hasClass("area-not-completed") && typeof progressiveForm != "undefined" && window.progressiveForm && i.push({
            name: "LastQuestion",
            value: !0
        });
        typeof $clickedNextButton != "undefined" && $clickedNextButton.hasClass("js-send-bank-details") && i.push({
            name: "BankingDetails",
            value: !0
        });
        $.ajax({
            type: "POST", url: "/crm/update/", data: $.param(i), success: function (n) {
                typeof t == "undefined" || t ? a() : (nt(n), $clickedNextButton.hasClass("js-perform-credit-search") && w())
            }, error: u
        })
    }, ft = function (n) {
        console.log("sendPartialApplication");
        var t = f(n), i = [];
        $.each(t, function (n, r) {
            r.value == "" || typeof r.value == "undefined" || i.push(t[n])
        });
        $.ajax({type: "POST", url: "page_API_POST.php", data: $.param(i), success: nt, error: u})
    }, et = function (n) {
        console.log("sendApplication normal");
        var t = f(n);
        sendMessage(JSON.stringify({from: getIframeName(), formSubmitted: !0}));
        $.ajax({type: "POST", url: "page_API_POST.php", data: $.param(t), success: a, error: u})
    }, h = function (n) {
        console.log("sendApplication normal");
        var t = f(n);
        sendMessage(JSON.stringify({from: getIframeName(), formSubmitted: !0}));
        $.ajax({type: "POST", url: "/crm/UpdateJointApp/", data: $.param(t), success: a, error: u})
    }, w = function (n) {
        $(".awaiting-results").addClass("active");
        console.log("get credit banding");
        var t = f(n);
        showCreditBandingResults(rng)
    }, ot = function () {
        typeof addressCondition == "undefined" || window.addressCondition === null ? customAddresses.addressTownToAddressCounty() : customAddresses[window.addressCondition]();
        (typeof noEmploymentAddress != "undefined" || window.addressCondition === null) && $.each(window.noEmploymentAddress, function (n, t) {
            $('[name="EmploymentType"]').val() == t && customAddresses.addressToJobAddress()
        })
    }, t = function (n, t, i) {
        for (var r in n) if (n[r].name == t) {
            n[r].value = i;
            break
        }
    }, c = function (n, t, i) {
        for (var r in n) if (n[r].name == t) {
            n[r].name = i;
            break
        }
    }, b = "", k = function () {
        var i = [], n = [], t = [];
        return $.each($("[addtonote]"), function () {
            var i = $(this).attr("addtonote") || "Other", r = $(this).val(), u = $(this).attr("name");
            r.length > 0 && n.indexOf(i) == -1 && (t.push(i + ":- "), n.push(i));
            t[n.indexOf(i)] = t[n.indexOf(i)] + " " + u + " : " + r + " ;"
        }), $.each(n, function (n) {
            var r = "addToNote[" + n + "].Content";
            i.push({name: r, value: t[n]})
        }), i
    }, st = function () {
        var i = ht($("#DobYear").val(), $("#DobMonth").val(), $("#DobDay").val()), n, t;
        return b = $('input[name="VisitorReference"]').val(), n = [{
            name: "VisitorReference",
            value: readQueryString("affcode") || b
        }], $("#DobYear").length > 0 && n.push({name: "Dob", value: i}), t = k(), $.each(t, function (i) {
            n.push(t[i])
        }), n
    }, ht = function (n, t, i) {
        return n + "-" + t + "-" + i
    }, ct = function (n, t) {
        if (console.log("response", n), n.Status.indexOf("Accepted") > -1) {
            var i = n.RedirectUrl;
            try {
                typeof formType != "undefined" && window.formType.indexOf("new-form") > -1 && (i += i.indexOf("?") > -1 ? "&nf=1" : "?nf=1")
            } catch (r) {
            }
            window.location.href = i
        } else setTimeout(function () {
            lt(t)
        }, 2e3)
    }, lt = function (n) {
        var t = $('input[name="ApiKey"]').val(),
            i = "https://iframe.app.autoconvert.co.uk//api.kingping.co.uk/api/carfinance/progress?ApiKey=" + t + "&ApplicationRef=" + n;
        $.ajax({
            type: "GET", dataType: "jsonp", url: i, success: function (t) {
                ct(t, n)
            }
        })
    };
    l = {
        utm_source: readQueryString("utm_source"),
        utm_medium: readQueryString("utm_medium"),
        utm_campaign: readQueryString("utm_campaign"),
        utm_term: readQueryString("utm_term"),
        utm_content: readQueryString("utm_content"),
        utm_name: readQueryString("utm_name"),
        affcode: readQueryString("affcode"),
        uniqueReference: $('input[name="UniqueReference"]').val(),
        sourceReference: $('input[name="SourceReference"]').val(),
        gclid: readQueryString("gclid"),
        fbclid: readQueryString("fbclid")
    };
    $(".custom-custom-fields").length > 0 && $(".custom-custom-fields input[data-add-to-querystring]").each(function () {
        l[$(this).attr("name")] = $(this).val()
    });
    var r = "", d = !1, e = "";
    $.each(l, function (n, t) {
        t && (e += "&" + n + "=" + t)
    });
    e = e.replace("&", "?");
    typeof thankYouPageUrl == "undefined" || window.thankYouPageUrl === null ? r = "/thank-you" : (r = "/" + window.thankYouPageUrl, window.thankYouPageUrl.indexOf("http") !== -1 && (d = window.thankYouPageUrl + e));
    g = "https://" + at(document.referrer);
    n = d || g + r + e;
    var u = function (n) {
        console.log("error response", n);
        $(".form-error").show();
        $(".btn-success").prop("disabled", !0);
        sendMessage(JSON.stringify({from: getIframeName(), acFormCompletionStatus: n}));
        it()
    }, tt = function () {
        $("#apply-modal").modal({keyboard: !1})
    }, it = function () {
        $("#apply-modal").modal("hide")
    };
    $(".js-next-form-step").on("click", function () {
        vt()
    });
    v = function () {
        it();
        $(".js-form-area").last().hide();
        $(".thank-you-area").show()
    };
    typeof jointAppAllowed != "undefined" && window.jointAppAllowed && readQueryString("acref") && readQueryString("acref").length > 0 && (window.jointApp = !0, ut = ["step1-start-breadcrumb-form", "step2-monthly-budget", "leasing-option"], $.each(ut, function (n, t) {
        $("#" + t).remove()
    }), $(".js-form-area").first().show(), $("[data-jointapp-text]").each(function () {
        $(this).text($(this).attr("data-jointapp-text"))
    }), $("form#car-finance-form").append('<input type="hidden" name="JointAppInit" value="True" />'))
});
url = parseURL(document.referrer);
parent_url = "http://" + url;
window.parentFullUrl;
var customHeaderEle = "", iFrameName = "", checkIframeName = function () {
    iFrameName !== "" && (clearInterval(IframeNameInterval), iframeNameRecieved())
}, IframeNameInterval = setInterval(checkIframeName, 15), iframeNameRecieved = function () {
    setHeightIframe();
    sendMessage(JSON.stringify({from: getIframeName(), formLoaded: !0}))
};
typeof headerEle != "undefined" && (customHeaderEle = headerEle);
sendMessage = function (n) {
    window.parent.postMessage(n, "*")
};
bindEvent(window, "message", function (n) {
    var t, r, i;
    try {
        t = JSON.parse(n.data)
    } catch (u) {
        return !1
    }
    typeof t == "object" && (t.iFrameName && (iFrameName = t.iFrameName), t.loanTypeRequested && ($('[data-type="' + t.loanTypeRequested.toUpperCase() + '"').parents(".button-list-holder").siblings().find("[data-selected]").removeAttr("data-selected"), $('[data-type="' + t.loanTypeRequested.toUpperCase() + '"').attr("data-selected", ""), $('[name="LoanType"]').val(t.loanTypeRequested.toUpperCase()), t.quoteTypes && (t.quoteTypes.lp ? $('[data-type="LP"').parent().show() : $('[data-type="LP"').parent().hide(), t.quoteTypes.pcp ? $('[data-type="PCP"').parent().show() : $('[data-type="PCP"').parent().hide())), t.loanMin && t.loanMax && updateSliderWithLoanValues(t.loanMin, t.loanMax), t.updateLoanAmount && ($(".loan-amount-display").val("£" + t.updateTotalFunded.toFixed(0)), $('[name="AmountToBorrow"]').val(t.updateTotalFunded.toFixed(0)), $("#loan-amount-slider").slider("option", "value", nearestSliderStepIndex(t.updateTotalFunded.toFixed(0), sliderStepValues))), t.updateLoanTerm && ($('[name="LoanTerm"]').length === 0 ? ($("form").prepend("<input type='hidden' name='LoanTerm'>"), $('[name="LoanTerm"]').val(t.updateLoanTerm)) : $('[name="LoanTerm"]').val(t.updateLoanTerm)), t.updateDeposit > -1 && ($('[name="Deposit"]').length === 0 ? ($("form").prepend("<input type='hidden' name='Deposit'>"), $('[name="Deposit"]').val(t.updateDeposit)) : $('[name="Deposit"]').val(t.updateDeposit)), t.updateAnnualMileage > -1 && ($('[name="EstimatedAnnualMileage"]').length === 0 ? ($("form").prepend("<input type='hidden' name='EstimatedAnnualMileage'>"), $('[name="EstimatedAnnualMileage"]').val(t.updateAnnualMileage)) : $('[name="EstimatedAnnualMileage"]').val(t.updateAnnualMileage)), t.updateModelYear > -1 && ($('[name="ModelYear"]').length === 0 ? ($("form").prepend("<input type='hidden' name='ModelYear'>"), $('[name="ModelYear"]').val(t.updateModelYear)) : $('[name="ModelYear"]').val(t.updateModelYear)), t.updateCalcReferrer && ($('[name="LoanVehicleType"]').length === 0 ? ($("form").prepend("<input type='hidden' name='LoanVehicleType'>"), $('[name="LoanVehicleType"]').val(t.updateCalcReferrer), $("form .vehicle-buttons-header, form .vehicle-buttons-holder").hide()) : $('[name="LoanVehicleType"]').length === 1 && $('[name="LoanVehicleType"]').val(t.updateCalcReferrer)), t.loanType && ($('[name="LoanType"]').length === 0 ? ($("form").prepend("<input type='hidden' name='LoanType'>"), $('[name="LoanType"]').val(t.loanType)) : $('[name="LoanType"]').length === 1 && $('[name="LoanType"]').val(t.loanType)), t.parentHeight && (parentHeight = t.parentHeight), t.parentFixedFooterHeight && (parentFixedFooter = t.parentFixedFooterHeight), t.parentScrollTop && (parentScrollTop = t.parentScrollTop), t.parentAcFormScrollTop && (parentAcFormScrollTop = t.parentAcFormScrollTop), t.setFormSliderMin && t.setFormSliderMax && updateSliderWithLoanValues(t.setFormSliderMin, t.setFormSliderMax), t.getFormHeight && setHeightIframe(), t.forceWindowResize && $(window).trigger("resize"), t.calcHasLoaded && (calcHasLoaded = t.calcHasLoaded), t.formHasLoaded && (formHasLoaded = t.formHasLoaded), t.additionalFormHasLoaded && (additionalFormHasLoaded = t.additionalFormHasLoaded), t.parentSettings && (typeof t.parentSettings.parentUrl != "undefined" && t.parentSettings.parentUrl.length > 1 && (window.parentUrl = t.parentSettings.parentUrl), typeof t.parentSettings.parentFullUrl != "undefined" && t.parentSettings.parentFullUrl.length > 1 && (window.parentFullUrl = t.parentSettings.parentFullUrl, $(document).trigger({type: "parentFullUrlReceived"}))), t.customFieldsJson && (r = JSON.parse(t.customFieldsJson), i = "", $.each(r, function (n, t) {
        (n.toLowerCase() == "value" || n.toLowerCase() == "mileage" || n.toLowerCase() == "retailvalue" || n.toLowerCase() == "amounttoborrow" || n.toLowerCase() == "estimatedannualmileage" || n.toLowerCase() == "deposit" || n.toLowerCase() == "enginesize") && (t = t.toString().replace(/,/g, ""));
        $(document).find('[name="' + n + '"]').length == 0 ? i += "<input type='hidden' name='" + n + "' value='" + t + "'/>" : $(document).find('[name="' + n + '"]').val(t).trigger("change")
    }), i.length > 0 && $("form").prepend("<div class='hidden'>" + i + "<\/div>"), $(document).trigger({type: "customFieldsAdded"})), t.addNote && $.ajax({
        type: "POST",
        url: "/crm/UpdateAppWithNote/",
        cache: !1,
        headers: {},
        data: t.addNote,
        success: function (n) {
            console.log("updated application with note");
            console.log(n);
            var t = JSON.stringify({from: getIframeName(), addAppNoteSuccess: n});
            sendMessage(t)
        },
        error: function (n) {
            console.log("error submitting");
            console.log(n);
            var t = JSON.stringify({from: getIframeName(), addAppNoteSuccess: !1});
            sendMessage(t)
        },
        datatype: "json",
        timeout: 3e4
    }), t.addVehicle && $.ajax({
        type: "POST",
        url: "/crm/UpdateAppWithVehicle/",
        cache: !1,
        headers: {},
        data: t.addVehicle,
        success: function (n) {
            console.log("updated application with vehicle");
            console.log(n);
            var t = JSON.stringify({from: getIframeName(), addAppVehicleSuccess: n});
            sendMessage(t)
        },
        error: function (n) {
            console.log("error submitting");
            console.log(n);
            var t = JSON.stringify({from: getIframeName(), addAppVehicleSuccess: !1});
            sendMessage(t)
        },
        datatype: "json",
        timeout: 3e4
    }))
});
var sliderStepValues = [], nearestSliderStepIndex = function (n, t) {
    for (var r, u = parseInt(n), f = t[0], e = 0, i = 0; i < t.length; i++) r = t[i], Math.abs(u - r) < Math.abs(u - f) && (f = r, e = i);
    return e
}, nearestIndex = function (n, t, i) {
    var f, u, r, e;
    for (i = typeof i != "undefined" ? i : !1, f = t[0], u = 0, r = 0; r < t.length; r++) e = t[r], Math.abs(n - e) < Math.abs(n - f) && (f = e, u = r, i && (u = n >= t[r] ? r : r - 1));
    return u
}, updateSliderWithLoanValues = function (n, t, i, r) {
    var u, o, e;
    sliderMinValue = parseInt(n);
    sliderMaxValue = parseInt(t);
    var f = typeof i != "undefined" ? i : [0, 100, 500, 1e3, 5e3, 1e4, 5e4, 1e5, 25e4, 5e5, 1e6, 2e6, 5e6, 1e7],
        s = typeof r != "undefined" ? r : [10, 25, 50, 100, 100, 1e3, 2e3, 5e3, 1e4, 2e4, 5e4, 1e5, 5e5, 1e6];
    sliderStepValues = [sliderMinValue];
    u = f.slice(nearestIndex(sliderMinValue, f, !0), nearestIndex(sliderMaxValue, f, !0) + 1);
    o = s.slice(nearestIndex(sliderMinValue, f, !0), nearestIndex(sliderMaxValue, f, !0) + 1);
    u.forEach(function (n, t) {
        for (var i = isNaN(u[t + 1]) ? u[u.length - 1] < sliderMaxValue ? sliderMaxValue : u[u.length - 1] : u[t + 1]; sliderStepValues[sliderStepValues.length - 1] < i;) sliderStepValues.push(o[t] + sliderStepValues[sliderStepValues.length - 1])
    });
    e = parseInt($('input[name="AmountToBorrow"]').val());
    $(document).ready(function () {
        $("#loan-amount-slider").slider("destroy");
        $("#loan-amount-slider").slider({
            value: isNaN(e) ? nearestSliderStepIndex(4e3, sliderStepValues) : nearestSliderStepIndex(e, sliderStepValues),
            min: 0,
            max: sliderStepValues.length - 1,
            step: 1,
            range: "min",
            slide: function (t, i) {
                n(sliderStepValues[i.value])
            }
        });
        $(".js-loan-amount-label").on("focus", function () {
            var t = $(this), i = parseInt($('input[name="AmountToBorrow"]').val());
            t.val("");
            t.off("blur").on("blur", function () {
                var t = parseInt($(this).val().replace("£", ""));
                isNaN(t) || t < sliderMinValue || t > sliderMaxValue ? ($("#loan-amount-slider").slider("value", nearestIndex(t, sliderStepValues)), t < sliderMinValue && n(sliderMinValue), t > sliderMaxValue && n(sliderMaxValue)) : (console.log("that one"), $("#loan-amount-slider").slider("value", nearestIndex(t, sliderStepValues)), n(t))
            })
        });
        $(".js-btn-loan-decrease").off().on("click", function () {
            var t = parseInt($("#loan-amount-slider").slider("value")) - 1;
            t >= 0 && ($("#loan-amount-slider").slider("value", t), n(sliderStepValues[t]))
        });
        $(".js-btn-loan-increase").off().on("click", function () {
            var t = parseInt($("#loan-amount-slider").slider("value")) + 1;
            t <= sliderStepValues.length - 1 && ($("#loan-amount-slider").slider("value", t), n(sliderStepValues[t]))
        });
        $('input[name="AmountToBorrow"]').on("change", function () {
            n(this.value)
        });
        var n = function (n) {
            $('input[name="AmountToBorrow"]').val(n);
            $(".js-loan-amount-label").val("£" + n)
        }
    })
}, updateMonthlyBudgetSliderWithLoanValues = function (n, t, i, r) {
    var o = parseInt(n), f = parseInt(t),
        s = typeof i != "undefined" ? i : [0, 500, 1e3, 5e3, 1e4, 5e4, 1e5, 25e4, 5e5, 1e6, 2e6, 5e6, 1e7],
        h = typeof r != "undefined" ? r : [25, 50, 100, 100, 100, 1e3, 2e3, 5e3, 1e4, 2e4, 5e4, 1e5, 5e5], u = [o],
        e = s.slice(nearestIndex(o, s, !0), nearestIndex(f, s, !0) + 1),
        c = h.slice(nearestIndex(o, s, !0), nearestIndex(f, s, !0) + 1);
    e.forEach(function (n, t) {
        for (var i = isNaN(e[t + 1]) ? e[e.length - 1] < f ? f : e[e.length - 1] : e[t + 1]; u[u.length - 1] < i;) u.push(c[t] + u[u.length - 1])
    });
    $(document).ready(function () {
        var t = parseInt($('input[name="MonthlyBudget"]').val()), n = function (n) {
            $('input[name="MonthlyBudget"]').val(n);
            $(".js-monthly-budget-amount-label").val("£" + n)
        };
        $("#monthly-budget-amount-slider").hasClass("ui-slider") && $("#monthly-budget-amount-slider").slider("destroy");
        $("#monthly-budget-amount-slider").slider({
            value: isNaN(t) ? nearestSliderStepIndex(500, u) : nearestSliderStepIndex(t, u),
            min: 0,
            max: u.length - 1,
            step: 1,
            range: "min",
            slide: function (t, i) {
                n(u[i.value])
            }
        });
        $(".js-monthly-budget-amount-label").on("focus", function () {
            var t = $(this), i = parseInt($('input[name="MonthlyBudget"]').val());
            t.val("");
            t.off("blur").on("blur", function () {
                var t = parseInt($(this).val().replace("£", ""));
                isNaN(t) || t < o || t > f ? ($("#monthly-budget-amount-slider").slider("value", nearestIndex(t, u)), t < o && n(o), t > f && n(f)) : (console.log("that one"), $("#monthly-budget-amount-slider").slider("value", nearestIndex(t, u)), n(t))
            })
        });
        $(".js-btn-monthly-budget-decrease").off().on("click", function () {
            var t = parseInt($("#monthly-budget-amount-slider").slider("value")) - 1;
            t >= 0 && ($("#monthly-budget-amount-slider").slider("value", t), n(u[t]))
        });
        $(".js-btn-monthly-budget-increase").off().on("click", function () {
            var t = parseInt($("#monthly-budget-amount-slider").slider("value")) + 1;
            t <= u.length - 1 && ($("#monthly-budget-amount-slider").slider("value", t), n(u[t]))
        });
        $('input[name="MonthlyBudget"]').on("change", function () {
            n(this.value)
        })
    })
};
updateMonthlyBudgetSliderWithLoanValues(50, 1e3);
var setHeightIframe = function () {
        var n = document.getElementsByClassName("form-holder")[0].clientHeight,
            t = JSON.stringify({from: getIframeName(), iFrameHeight: n});
        sendMessage(t)
    }, parentHeight, parentFixedFooter = 0, parentScrollTop, parentAcFormScrollTop, calcHasLoaded = !1, formHasLoaded = !1,
    additionalFormHasLoaded = !1, alreadyStarted = !1;
$(document).ready(function () {
    function f(n) {
        for (var t, r = encodeURIComponent(n) + "=", u = document.cookie.split(";"), i = 0; i < u.length; i++) {
            for (t = u[i]; t.charAt(0) === " ";) t = t.substring(1, t.length);
            if (t.indexOf(r) === 0) return decodeURIComponent(t.substring(r.length, t.length))
        }
        return null
    }

    var r = f("VisitorReference"), u, t, i, n;
    r && $("#VisitorReference").val(r);
    $(document).find(".applicant-address .address-list").length > 0 && $(document).find(".applicant-address .address-list")[0].addEventListener("change", function () {
        sendMessage(JSON.stringify({from: getIframeName(), scrollTo: $(".progress-container").offset().top}))
    });
    u = function (n) {
        var i = parentScrollTop + parentHeight - parentFixedFooter, t = n.parents(".js-form-area").find(".js-btn-next"),
            r = parentAcFormScrollTop + (t.offset().top + t.outerHeight(!0));
        return r + parentScrollTop <= i
    };
    t = function () {
        var n = parentScrollTop + parentHeight - parentFixedFooter, t = +window.innerHeight,
            i = parentScrollTop + parentHeight >= parentAcFormScrollTop && parentScrollTop <= parentAcFormScrollTop,
            r = t <= n;
        return r && i
    };
    $(".js-btn-next").click(function () {
        setHeightIframe();
        var n = $(this).parents(".js-form-area"), i = $(".form-holder").offset().top;
        return t($(this)) || sendMessage(JSON.stringify({
            from: getIframeName(),
            scrollTo: i,
            includeHeaderHeight: !0
        })), (typeof n.data("completed") == "undefined" || typeof n.data("completed") == null) && (sendMessage(JSON.stringify({
            from: getIframeName(),
            stepCompleted: n.data("step-name")
        })), $(document).trigger("stepCompleted", n.data("step-name")), n.attr("data-completed", !0)), setTimeout(function () {
            var t = $(document).find(".js-form-area:visible");
            (typeof t.data("completed") == "undefined" || typeof t.data("completed") == null) && t.data("step-name") != n.data("step-name") && sendMessage(JSON.stringify({
                from: getIframeName(),
                stepStarted: t.data("step-name")
            }))
        }, 150), !1
    });
    $(".btn-get-started").on("click", function () {
        if (!alreadyStarted) {
            var n = JSON.stringify({from: getIframeName(), formStarted: !0});
            sendMessage(n);
            alreadyStarted = !0
        }
    });
    i = function (n, t) {
        var r = n.prev();
        r.length > 0 && r.hasClass(t) ? (r.removeClass(t), i(r, t)) : r.show()
    };
    $(".js-btn-back").on("click", function (n) {
        $(this).parents(".js-form-area").hide();
        i($(this).parents(".js-form-area"), "skipped-area");
        setHeightIframe();
        var r = $(".form-holder").offset().top;
        t($(this)) || sendMessage(JSON.stringify({from: getIframeName(), scrollTo: r, includeHeaderHeight: !0}));
        updateFormStepLabel(null, $(".js-form-area:visible").index() - $(".js-form-area").first().index());
        n.preventDefault()
    });
    $(document).on("click", ".button-list", function () {
        var n = $(this).parents(".js-form-area").find(".js-btn-next"),
            t = document.getElementsByClassName("form-holder")[0].clientHeight,
            i = n.offset().top + n.outerHeight(!0) - parentHeight + parentFixedFooter;
        settings = u($(this)) ? {from: getIframeName(), iframeHeight: t} : {
            from: getIframeName(),
            scrollTo: i,
            iframeHeight: t,
            includeHeaderHeight: !1
        };
        sendMessage(JSON.stringify(settings))
    });
    $(document).on("click", ".edit-address, .update-current-address-btn, .enter-address-manually, select.address-list", function () {
        setHeightIframe();
        setTimeout(function () {
            setHeightIframe()
        }, 500)
    });
    if ($(".monthly-breakdown .btn.apply-now").length > 0) $(".monthly-breakdown .btn.apply-now").on("click", function (n) {
        n.preventDefault();
        var t = $(this).attr("href");
        sendMessage(JSON.stringify({from: getIframeName(), redirect: t}))
    });
    $(window).resize(function () {
        setHeightIframe()
    });
    setHeightIframe();
    window.setTimeout(setHeightIframe, 2e3);
    $("body").fadeIn(1200);
    n = $(document).find("#vehicleImageURL") || "";
    n.on("load", function () {
        n.show();
        setHeightIframe()
    });
    n.one("error", function () {
        console.log("error loading " + this.src);
        setHeightIframe();
        n.hide()
    });
    if (typeof quickForm != "undefined" && quickForm) {
        $(".button-list").on("click", function () {
            var n = $(this).parents(".js-form-area");
            n.attr("id") != "step13-firstname-surname-form" && n.attr("id") != "step2-dob-form" && n.find(".js-btn-next").trigger("click")
        });
        $(".button-list[data-selected]").removeAttr("data-selected")
    }
    $(window).load(function () {
        n.length > 0 && (n[0].src = n[0].src)
    });
    sendMessage(JSON.stringify({from: getIframeName(), customHeaderRedirectEle: customHeaderEle}))
});
ACFormOptionsAvailable = function () {
    var n = [];
    return $(".js-form-area input").each(function () {
        if (typeof $(this).attr("name") != "undefined" && $(this).attr("name").length > 0) {
            var i = $(this).attr("name"), t = [];
            $(this).siblings(".button-list-holder").length > 0 && $(this).siblings(".button-list-holder").each(function () {
                t.push($(this).text().trim())
            });
            $(this).attr("name") == "VehicleType" && $(this).siblings(".vehicle-buttons-holder").find(".btn-circle-holder").length > 0 && $(this).siblings(".vehicle-buttons-holder").find(".btn-circle-holder").each(function () {
                t.push($(this).find(".button-text").text().trim())
            });
            n[i] = t.length > 0 ? t : ""
        }
    }), n
};
